<!DOCTYPE html>

<html>

<head>

    <!--

    WebGL_example_28.html

    Applying a texture

    J. Madeira - November 2015

    -->

    <title>University Panorama</title>

    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
    <link rel="stylesheet" type="text/css" href="bootstrap-4.0.0-dist/css/bootstrap.css" />
    <style>
    .leftcol {
	    width:300px;
	    height:auto;
	    float:left;
 	}
 	</style>


    <!--

    The vertex and fragment shaders.

    -->

    <script id="shader-vs" type="x-shader/x-vertex">

        attribute vec3 aVertexPosition;

        attribute vec3 aVertexColor;

        attribute vec2 aTextureCoord;

        uniform mat4 uMVMatrix;

        uniform mat4 uPMatrix;

        varying vec2 vTextureCoord;

        varying vec4 vertexColor;

        void main(void) {

        // To allow seeing the points drawn
        gl_PointSize = 5.0;

        // Just converting the (x,y,z) vertices to Homogeneous Coord.
        // And multiplying by the Projection and the Model-View matrix
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);

        // For the fragment shader
        vTextureCoord = aTextureCoord;

        // Converting the RGB color value to RGBA
        vertexColor = vec4(aVertexColor, 1.0);
        }
    </script>

    <script id="shader-fs" type="x-shader/x-fragment">

        precision mediump float;

        varying vec2 vTextureCoord;

        varying vec4 vertexColor;

        uniform sampler2D uSampler;

        uniform float isTexture;

        void main(void) {
        if(isTexture==1.0){
        gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
        }else{
        gl_FragColor = vertexColor;
        }
        }

    </script>

    <script id="vs" type="x-shader/vertex"> 
		attribute vec3 position;

		void main() {
			gl_Position = vec4( position, 1.0 );
		}
	</script> 

	<script id="fs" type="x-shader/fragment"> 
		uniform vec2 resolution;
		uniform sampler2D texture;
		uniform float fov;
		uniform float yaw; 
		uniform float pitch;
		const float M_PI = 3.141592653589793238462643;
		const float M_TWOPI = 6.283185307179586476925286;
		mat3 rotationMatrix(vec2 euler)
		{
			vec2 se = sin(euler);
			vec2 ce = cos(euler);
			return 	mat3(ce.x, 0, -se.x,	0, 1, 0,		se.x, 0, ce.x) * 
					mat3(1, 0, 0,			0, ce.y, -se.y,	0, se.y, ce.y);
		}

		vec3 toCartesian( vec2 st )
		{
			return normalize(vec3(st.x, st.y, 0.5 / tan(0.5 * radians(fov))));
		}
		vec2 toSpherical(vec3 cartesianCoord)
		{
			vec2 st = vec2(
				atan(cartesianCoord.x, cartesianCoord.z),
				acos(cartesianCoord.y)
			);
			if(st.x < 0.0)
				st.x += M_TWOPI;	
			return st;
		}
		void main(void)
		{
			vec2 sphericalCoord = gl_FragCoord.xy / resolution - vec2(0.5);
			sphericalCoord.y *= -resolution.y / resolution.x;
			vec3 cartesianCoord = rotationMatrix(radians(vec2(yaw + 180., -pitch))) * toCartesian(sphericalCoord);
			gl_FragColor = texture2D(texture, toSpherical( cartesianCoord )/vec2(M_TWOPI, M_PI));
		}
	</script> 

    <!-- The JS files -->
    <!-- Some useful functions for browser compatibility -->

    <script type="text/javascript" src="webgl-utils.js"></script>

    <!-- Handling vectors and matrices -->

    <script type="text/javascript" src="maths.js"></script>

	<!-- Processing triangle mesh models -->

	<script type="text/javascript" src="models.js"></script>

	<script type="text/javascript" src="spheres.js"></script>

    <!-- WebGL code -->

    <script type="text/javascript" src="initShaders.js"></script>

    <script type="text/javascript" src="WebGL_example_28.js"></script>

</head>

<body onload="runWebGL();">

	<div class="leftcol" style="text-align: center">
		<p></p>
	  <h4>Escolha os departamentos que quer ver:</h4>
	  <input type="checkbox" class="checks" value="DMAT" checked>Departamento de Matematica<br>
	  <input type="checkbox" class="checks" value="DCPT" checked>Departamento de Ciencias Sociais<br>
	  <input type="checkbox" class="checks" value="DMEC" checked>Departamento de Engenharia Mecanica<br>
	  <input type="checkbox" class="checks" value="DEG" checked>Departamento de Engenharia Civil<br>
	  <a href="#" onclick="getValue();return false;">Submeter</a>
	</div>

	<div style="text-align: center">
		
		<h3>Mapa da Universidade</h3>
		<canvas id="my-canvas" width="1150" height="650"></canvas>

		<p> Vista 360 </p>
		<canvas id="360-canvas" style="border:10px solid #000000;" width="1150" height="650"></canvas>
		<picture></picture>
				
		
				
	</div>

</body>

</html>
